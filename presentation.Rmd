---
title: "Predicting House Prices"
author: "Danking-team Junzhe Wang and Yuanchang Zhang"
institute: "University of Edinburgh"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    self_contained: true
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false

      
---

```{r install-package, include = FALSE, eval = FALSE}
# Copy and paste the following code into your console to download and install
# the `xaringan` package that contains all of the code which allows you 
# to create presentation slides in Rmarkdown
install.packages('xaringan')
```


```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
library(ggplot2)
library(dplyr)
library(tidymodels)
library(kableExtra)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.retina = 3, dpi = 300, fig.width = 6, fig.asp = 0.618, out.width = "80%")
```

```{r load-data, include=FALSE}
# Load your data here
data1 <- read_csv("data/train.csv")



```

```{r include=FALSE}

#Background image
style_xaringan(
  title_slide_background_image = "img/confetti.jpg"
)
```

class: center, middle

## model to predict house SalePrice

---

class: inverse, center, middle

# Exploratory Data Analysis

---


```{r recode-species, echo = FALSE}
#Plot
# In this chunk I'm doing a bunch of analysis that I don't want to present 
# in my slides. But I need the resulting data frame for a plot I want to present.
col_na_percent <- (colSums(is.na(data1)) / nrow(data1)) * 100

data1 <- data1[,colMeans(is.na(data1))<=0.05]

data1_clean <- data1 %>% drop_na()

numeric_vars <- data1_clean %>%
  select(where(is.numeric))

cor_matrix <- cor(numeric_vars, use = "complete.obs")


top5_cor <- cor_matrix %>%
  as.data.frame.table() %>%  
  filter(Var2 == "SalePrice",
         Var1 != "SalePrice") %>%  
  mutate(abs_cor = abs(Freq)) %>%  
  arrange(desc(abs_cor)) %>% 
  head(5)


top_vars <- as.character(top5_cor$Var1)


lm_model <- linear_reg() %>%
  set_engine("lm")


data_model <- data1_clean %>%
  select(SalePrice, all_of(top_vars))



set.seed(28)
data_split <- initial_split(data_model, prop = 0.8)
data_train <- training(data_split)
data_test  <- testing(data_split)


house_recipe <- recipe(SalePrice ~ ., data = data_train) %>%
  step_dummy(all_nominal(), -all_outcomes())


house_wflow <- workflow() %>%
  add_recipe(house_recipe) %>%
  add_model(lm_model)
```


#NA Percent
```{r iris-table ,echo = FALSE}
na_table <- data.frame(
  Variable   = names(col_na_percent),
  NA_percent = as.numeric(col_na_percent)
)

kable(na_table, format = "html", digits = 3)

```
---


#5 Variable Most Strongly Correlated with SalePrice
```{r,echo = FALSE}
kable(top5_cor, format = "html", digits = 3)

```
---


# Model Summary

```{r boring-regression, echo = FALSE}


house_fit <- house_wflow %>% fit(data = data_train)


tidy(house_fit) %>%
  kable("html", digits=3) %>%
  kable_styling(full_width = FALSE)
```
---

# Model Summary
```{r boring-regression b, echo = FALSE}


house_fit <- house_wflow %>% fit(data = data_train)

house_pred <- predict(house_fit, data_test) %>%
  bind_cols(data_test)

rmse_val <- rmse(house_pred, truth = SalePrice, .pred)$.estimate
rsq_val  <- rsq(house_pred, truth = SalePrice, .pred)$.estimate

metrics_table <- data.frame(
  Metric = c("RMSE", "R-squared"),
  Value  = c(rmse_val, rsq_val)
)

kable(metrics_table, format="html", digits=3) %>%
  kable_styling(full_width = FALSE)
```
---





## Plot and text

.pull-left[
- OverallQual is an ordinal variable ranging from 1 to 10  
- Higher quality ratings are strongly associated with higher SalePrice  
- The relationship shows a clear stepwise upward trend  
- Homes rated 8–10 tend to be significantly more expensive 
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
# see how I changed out.width and fig.width from defaults
# to make the figure bigger
plots <- lapply(top_vars, function(var) {
  ggplot(data1_clean, aes(x = .data[[var]], y = SalePrice)) +
    geom_point(alpha = 0.5) + 
    geom_smooth(method = "lm", se = FALSE, color = "red") +
    labs(title = paste("SalePrice vs", var),
         x = var,
         y = "SalePrice") +
    theme_minimal()
})
print(plots[[1]])
```
]

---

## Plot and text

.pull-left[
- GrLivArea shows a strong positive linear relationship with SalePrice  
- Larger living areas generally correspond to higher prices  
- Data points form a continuous distribution with a clear upward trend  
- A few large and expensive outliers are present  
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
print(plots[[2]])
```
]

---

## Plot and text

.pull-left[
- GarageCars is a discrete variable taking values from 0 to 4  
- More parking spaces are associated with higher SalePrice  
- Scatter points cluster by categories (0–4), forming a stepwise pattern
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
print(plots[[3]])
```
]

---

## Plot and text

.pull-left[
- GarageArea shows a positive relationship with SalePrice  
- The upward trend is present but more dispersed compared to other variables  
- Many observations are concentrated in smaller garage sizes  
- Indicates that garage size contributes to price, but with greater variability  
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
print(plots[[4]])
```
]

---

## Plot and text

.pull-left[
- 1stFlrSF has a clear positive linear association with SalePrice  
- Larger first-floor areas tend to increase the overall home price  
- Points show a linear pattern with some high-area outliers  
- Similar in trend to GrLivArea, as both measure interior space 
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
print(plots[[5]])
```
]

---

## Plot and text

.pull-left[
- Predictions align closely with actual SalePrice values.
- The tight clustering around the diagonal line suggests strong model performance.
- Some deviation appears for more expensive houses.
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
pic<-ggplot(house_pred, aes(x = .pred, y = SalePrice)) +
  geom_point(alpha = 0.5) +
  geom_abline(slope = 1, intercept = 0, color = "red") +
  labs(
    title = "Predicted vs Actual SalePrice",
    x = "Predicted SalePrice",
    y = "Actual SalePrice"
  ) +
  theme_minimal()
pic
```
]

---

## Plot and text

.pull-left[
- Residuals approximately follow a normal distribution.
- Minor departures occur at the extreme quantiles.

]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
house_pred <- house_pred %>%
  mutate(residuals = SalePrice - .pred)


pic2<-ggplot(house_pred, aes(sample = residuals)) +
  stat_qq(alpha = 0.5) +
  stat_qq_line(color = "red", linewidth = 1) +
  labs(
    title = "QQ Plot of Model Residuals",
    x = "Theoretical Quantiles",
    y = "Sample Quantiles"
  ) +
  theme_minimal()
pic2
```
]

---

## Plot and text

.pull-left[
- Residuals are mostly centered around zero, indicating no major systematic bias.
- Some increasing spread at higher fitted values suggests slight heteroscedasticity.
]
.pull-right[
```{r warning=FALSE, out.width="100%", fig.width=4, echo=FALSE}
pic2<-ggplot(house_pred, aes(x = .pred, y = residuals)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "red") +
  theme_minimal() +
  labs(title = "Residuals vs Fitted Values")
pic2
```
]
